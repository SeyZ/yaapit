/*
 * $Id: rawinflate.js,v 0.2 2009/03/01 18:32:24 dankogai Exp $
 *
 * original:
 * http://www.onicos.com/staff/iz/amuse/javascript/expert/inflate.txt
 */(function(){var e=32768,t=0,n=1,r=2,i=9,s=6,o=32768,u=64,a,f,l=null,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535),k=new Array(3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0),L=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99),A=new Array(1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577),O=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),M=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15),_=function(){this.next=null,this.list=null},D=function(){this.e=0,this.b=0,this.n=0,this.t=null},P=function(e,t,n,r,i,s){this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var o,u=new Array(this.BMAX+1),a,f,l,c,h,p,d,v=new Array(this.BMAX+1),m,g,y,b=new D,w=new Array(this.BMAX),E=new Array(this.N_MAX),S,x=new Array(this.BMAX+1),T,N,C,k,L;L=this.root=null;for(h=0;h<u.length;h++)u[h]=0;for(h=0;h<v.length;h++)v[h]=0;for(h=0;h<w.length;h++)w[h]=null;for(h=0;h<E.length;h++)E[h]=0;for(h=0;h<x.length;h++)x[h]=0;a=t>256?e[256]:this.BMAX,m=e,g=0,h=t;do u[m[g]]++,g++;while(--h>0);if(u[0]==t){this.root=null,this.m=0,this.status=0;return}for(p=1;p<=this.BMAX;p++)if(u[p]!=0)break;d=p,s<p&&(s=p);for(h=this.BMAX;h!=0;h--)if(u[h]!=0)break;l=h,s>h&&(s=h);for(N=1<<p;p<h;p++,N<<=1)if((N-=u[p])<0){this.status=2,this.m=s;return}if((N-=u[h])<0){this.status=2,this.m=s;return}u[h]+=N,x[1]=p=0,m=u,g=1,T=2;while(--h>0)x[T++]=p+=m[g++];m=e,g=0,h=0;do(p=m[g++])!=0&&(E[x[p]++]=h);while(++h<t);t=x[l],x[0]=h=0,m=E,g=0,c=-1,S=v[0]=0,y=null,C=0;for(;d<=l;d++){o=u[d];while(o-->0){while(d>S+v[1+c]){S+=v[1+c],c++,C=(C=l-S)>s?s:C;if((f=1<<(p=d-S))>o+1){f-=o+1,T=d;while(++p<C){if((f<<=1)<=u[++T])break;f-=u[T]}}S+p>a&&S<a&&(p=a-S),C=1<<p,v[1+c]=p,y=new Array(C);for(k=0;k<C;k++)y[k]=new D;L==null?L=this.root=new _:L=L.next=new _,L.next=null,L.list=y,w[c]=y,c>0&&(x[c]=h,b.b=v[c],b.e=16+p,b.t=y,p=(h&(1<<S)-1)>>S-v[c],w[c-1][p].e=b.e,w[c-1][p].b=b.b,w[c-1][p].n=b.n,w[c-1][p].t=b.t)}b.b=d-S,g>=t?b.e=99:m[g]<n?(b.e=m[g]<256?16:15,b.n=m[g++]):(b.e=i[m[g]-n],b.n=r[m[g++]-n]),f=1<<d-S;for(p=h>>S;p<C;p+=f)y[p].e=b.e,y[p].b=b.b,y[p].n=b.n,y[p].t=b.t;for(p=1<<d-1;(h&p)!=0;p>>=1)h^=p;h^=p;while((h&(1<<S)-1)!=x[c])S-=v[c],c--}}this.m=v[1],this.status=N!=0&&l!=1?1:0},H=function(){return T.length==N?-1:T.charCodeAt(N++)&255},B=function(e){while(v<e)d|=H()<<v,v+=8},j=function(e){return d&C[e]},F=function(e){d>>=e,v-=e},I=function(t,n,r){var i,s,o;if(r==0)return 0;o=0;for(;;){B(S),s=w.list[j(S)],i=s.e;while(i>16){if(i==99)return-1;F(s.b),i-=16,B(i),s=s.t[j(i)],i=s.e}F(s.b);if(i==16){f&=e-1,t[n+o++]=a[f++]=s.n;if(o==r)return r;continue}if(i==15)break;B(i),y=s.n+j(i),F(i),B(x),s=E.list[j(x)],i=s.e;while(i>16){if(i==99)return-1;F(s.b),i-=16,B(i),s=s.t[j(i)],i=s.e}F(s.b),B(i),b=f-s.n-j(i),F(i);while(y>0&&o<r)y--,b&=e-1,f&=e-1,t[n+o++]=a[f++]=a[b++];if(o==r)return r}return m=-1,o},q=function(t,n,r){var i;i=v&7,F(i),B(16),i=j(16),F(16),B(16);if(i!=(~d&65535))return-1;F(16),y=i,i=0;while(y>0&&i<r)y--,f&=e-1,B(8),t[n+i++]=a[f++]=j(8),F(8);return y==0&&(m=-1),i},R=function(e,t,n){if(l==null){var r,i=new Array(288),s;for(r=0;r<144;r++)i[r]=8;for(;r<256;r++)i[r]=9;for(;r<280;r++)i[r]=7;for(;r<288;r++)i[r]=8;h=7,s=new P(i,288,257,k,L,h);if(s.status!=0)return alert("HufBuild error: "+s.status),-1;l=s.root,h=s.m;for(r=0;r<30;r++)i[r]=5;zip_fixed_bd=5,s=new P(i,30,0,A,O,zip_fixed_bd);if(s.status>1)return l=null,alert("HufBuild error: "+s.status),-1;c=s.root,zip_fixed_bd=s.m}return w=l,E=c,S=h,x=zip_fixed_bd,I(e,t,n)},U=function(e,t,n){var r,o,u,a,f,l,c,h,p=new Array(316),d;for(r=0;r<p.length;r++)p[r]=0;B(5),c=257+j(5),F(5),B(5),h=1+j(5),F(5),B(4),l=4+j(4),F(4);if(c>286||h>30)return-1;for(o=0;o<l;o++)B(3),p[M[o]]=j(3),F(3);for(;o<19;o++)p[M[o]]=0;S=7,d=new P(p,19,19,null,null,S);if(d.status!=0)return-1;w=d.root,S=d.m,a=c+h,r=u=0;while(r<a){B(S),f=w.list[j(S)],o=f.b,F(o),o=f.n;if(o<16)p[r++]=u=o;else if(o==16){B(2),o=3+j(2),F(2);if(r+o>a)return-1;while(o-->0)p[r++]=u}else if(o==17){B(3),o=3+j(3),F(3);if(r+o>a)return-1;while(o-->0)p[r++]=0;u=0}else{B(7),o=11+j(7),F(7);if(r+o>a)return-1;while(o-->0)p[r++]=0;u=0}}S=i,d=new P(p,c,257,k,L,S),S==0&&(d.status=1);if(d.status!=0)return d.status==1,-1;w=d.root,S=d.m;for(r=0;r<h;r++)p[r]=p[r+c];return x=s,d=new P(p,h,0,A,O,x),E=d.root,x=d.m,x==0&&c>257?-1:(d.status==1,d.status!=0?-1:I(e,t,n))},z=function(){var t;a==null&&(a=new Array(2*e)),f=0,d=0,v=0,m=-1,g=!1,y=b=0,w=null},W=function(n,r,i){var s,o;s=0;while(s<i){if(g&&m==-1)return s;if(y>0){if(m!=t)while(y>0&&s<i)y--,b&=e-1,f&=e-1,n[r+s++]=a[f++]=a[b++];else{while(y>0&&s<i)y--,f&=e-1,B(8),n[r+s++]=a[f++]=j(8),F(8);y==0&&(m=-1)}if(s==i)return s}if(m==-1){if(g)break;B(1),j(1)!=0&&(g=!0),F(1),B(2),m=j(2),F(2),w=null,y=0}switch(m){case 0:o=q(n,r+s,i-s);break;case 1:w!=null?o=I(n,r+s,i-s):o=R(n,r+s,i-s);break;case 2:w!=null?o=I(n,r+s,i-s):o=U(n,r+s,i-s);break;default:o=-1}if(o==-1)return g?0:-1;s+=o}return s},X=function(e){var t,n;z(),T=e,N=0;var r=new Array(1024),i=[];while((t=W(r,0,r.length))>0){var s=new Array(t);for(n=0;n<t;n++)s[n]=String.fromCharCode(r[n]);i[i.length]=s.join("")}return T=null,i.join("")};window.RawDeflate||(RawDeflate={}),RawDeflate.inflate=X})();