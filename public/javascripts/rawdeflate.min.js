/*
 * $Id: rawdeflate.js,v 0.3 2009/03/01 19:05:05 dankogai Exp dankogai $
 *
 * Original:
 *   http://www.onicos.com/staff/iz/amuse/javascript/expert/deflate.txt
 */(function(){var e=32768,t=0,n=1,r=2,i=6,s=!0,o=32768,u=64,a=8192,f=2*e,l=3,c=258,h=16,p=8192,d=13;p>o&&alert("error: zip_INBUFSIZ is too small"),e<<1>1<<h&&alert("error: zip_WSIZE is too large"),d>h-1&&alert("error: zip_HASH_BITS is too large"),(d<8||c!=258)&&alert("error: Code too clever");var v=p,m=1<<d,g=m-1,y=e-1,b=0,w=4096,E=c+l+1,S=e-E,x=1,T=15,N=7,C=29,k=256,L=256,A=k+1+C,O=30,M=19,_=16,D=17,P=18,H=2*A+1,B=parseInt((d+l-1)/l),j,F,I,q,R=null,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Ht,Bt,jt,Ft,It,qt=function(){this.fc=0,this.dl=0},Rt=function(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0},Ut=function(e,t,n,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r},zt=function(){this.next=null,this.len=0,this.ptr=new Array(a),this.off=0},Wt=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0),Xt=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),Vt=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7),$t=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15),Jt=new Array(new Ut(0,0,0,0),new Ut(4,4,8,4),new Ut(4,5,16,8),new Ut(4,6,32,32),new Ut(4,4,16,16),new Ut(8,16,32,32),new Ut(8,16,128,128),new Ut(8,32,128,256),new Ut(32,128,258,1024),new Ut(32,258,258,4096)),Kt=function(e){var t;e?e<1?e=1:e>9&&(e=9):e=i,lt=e,q=!1,ot=!1;if(R!=null)return;j=F=I=null,R=new Array(a),X=new Array(f),V=new Array(v),$=new Array(o+u),J=new Array(1<<h),pt=new Array(H);for(t=0;t<H;t++)pt[t]=new qt;dt=new Array(2*O+1);for(t=0;t<2*O+1;t++)dt[t]=new qt;vt=new Array(A+2);for(t=0;t<A+2;t++)vt[t]=new qt;mt=new Array(O);for(t=0;t<O;t++)mt[t]=new qt;gt=new Array(2*M+1);for(t=0;t<2*M+1;t++)gt[t]=new qt;yt=new Rt,bt=new Rt,wt=new Rt,Et=new Array(T+1),St=new Array(2*A+1),Nt=new Array(2*A+1),Ct=new Array(c-l+1),kt=new Array(512),Lt=new Array(C),At=new Array(O),Ot=new Array(parseInt(p/8))},Qt=function(){j=F=I=null,R=null,X=null,V=null,$=null,J=null,pt=null,dt=null,vt=null,mt=null,gt=null,yt=null,bt=null,wt=null,Et=null,St=null,Nt=null,Ct=null,kt=null,Lt=null,At=null,Ot=null},Gt=function(e){e.next=j,j=e},Yt=function(){var e;return j!=null?(e=j,j=j.next):e=new zt,e.next=null,e.len=e.off=0,e},Zt=function(t){return J[e+t]},en=function(t,n){return J[e+t]=n},tn=function(e){R[z+U++]=e,z+U==a&&Pn()},nn=function(e){e&=65535,z+U<a-2?(R[z+U++]=e&255,R[z+U++]=e>>>8):(tn(e&255),tn(e>>>8))},rn=function(){Y=(Y<<B^X[it+l-1]&255)&g,Z=Zt(Y),J[it&y]=Z,en(Y,it)},sn=function(e,t){Mn(t[e].fc,t[e].dl)},on=function(e){return(e<256?kt[e]:kt[256+(e>>7)])&255},un=function(e,t,n){return e[t].fc<e[n].fc||e[t].fc==e[n].fc&&Nt[t]<=Nt[n]},an=function(e,t,n){var r;for(r=0;r<n&&It<Ft.length;r++)e[t+r]=Ft.charCodeAt(It++)&255;return r},fn=function(){var t;for(t=0;t<m;t++)J[e+t]=0;ft=Jt[lt].max_lazy,ct=Jt[lt].good_length,s||(ht=Jt[lt].nice_length),at=Jt[lt].max_chain,it=0,G=0,ut=an(X,0,2*e);if(ut<=0){ot=!0,ut=0;return}ot=!1;while(ut<E&&!ot)cn();Y=0;for(t=0;t<l-1;t++)Y=(Y<<B^X[t]&255)&g},ln=function(e){var t=at,n=it,r,i,o=rt,u=it>S?it-S:b,a=it+c,f=X[n+o-1],l=X[n+o];rt>=ct&&(t>>=2);do{r=e;if(X[r+o]!=l||X[r+o-1]!=f||X[r]!=X[n]||X[++r]!=X[n+1])continue;n+=2,r++;do;while(X[++n]==X[++r]&&X[++n]==X[++r]&&X[++n]==X[++r]&&X[++n]==X[++r]&&X[++n]==X[++r]&&X[++n]==X[++r]&&X[++n]==X[++r]&&X[++n]==X[++r]&&n<a);i=c-(a-n),n=a-c;if(i>o){st=e,o=i;if(s){if(i>=c)break}else if(i>=ht)break;f=X[n+o-1],l=X[n+o]}}while((e=J[e&y])>u&&--t!=0);return o},cn=function(){var t,n,r=f-ut-it;if(r==-1)r--;else if(it>=e+S){for(t=0;t<e;t++)X[t]=X[t+e];st-=e,it-=e,G-=e;for(t=0;t<m;t++)n=Zt(t),en(t,n>=e?n-e:b);for(t=0;t<e;t++)n=J[t],J[t]=n>=e?n-e:b;r+=e}ot||(t=an(X,it+ut,r),t<=0?ot=!0:ut+=t)},hn=function(){while(ut!=0&&F==null){var e;rn(),Z!=b&&it-Z<=S&&(nt=ln(Z),nt>ut&&(nt=ut));if(nt>=l){e=Ln(it-st,nt-l),ut-=nt;if(nt<=ft){nt--;do it++,rn();while(--nt!=0);it++}else it+=nt,nt=0,Y=X[it]&255,Y=(Y<<B^X[it+1]&255)&g}else e=Ln(0,X[it]&255),ut--,it++;e&&(kn(0),G=it);while(ut<E&&!ot)cn()}},pn=function(){while(ut!=0&&F==null){rn(),rt=nt,et=st,nt=l-1,Z!=b&&rt<ft&&it-Z<=S&&(nt=ln(Z),nt>ut&&(nt=ut),nt==l&&it-st>w&&nt--);if(rt>=l&&nt<=rt){var e;e=Ln(it-1-et,rt-l),ut-=rt-1,rt-=2;do it++,rn();while(--rt!=0);tt=0,nt=l-1,it++,e&&(kn(0),G=it)}else tt!=0?(Ln(0,X[it-1]&255)&&(kn(0),G=it),it++,ut--):(tt=1,it++,ut--);while(ut<E&&!ot)cn()}},dn=function(){if(ot)return;K=0,Q=0,gn(),fn(),F=null,U=0,z=0,lt<=3?(rt=l-1,nt=0):(nt=l-1,tt=0),W=!1},vn=function(e,t,n){var r;if(!q){dn(),q=!0;if(ut==0)return W=!0,0}return(r=mn(e,t,n))==n?n:W?r:(lt<=3?hn():pn(),ut==0&&(tt!=0&&Ln(0,X[it-1]&255),kn(1),W=!0),r+mn(e,r+t,n-r))},mn=function(e,t,n){var r,i,s;r=0;while(F!=null&&r<n){i=n-r,i>F.len&&(i=F.len);for(s=0;s<i;s++)e[t+r+s]=F.ptr[F.off+s];F.off+=i,F.len-=i,r+=i;if(F.len==0){var o;o=F,F=F.next,Gt(o)}}if(r==n)return r;if(z<U){i=n-r,i>U-z&&(i=U-z);for(s=0;s<i;s++)e[t+r+s]=R[z+s];z+=i,r+=i,U==z&&(U=z=0)}return r},gn=function(){var e,t,n,r,i;if(mt[0].dl!=0)return;yt.dyn_tree=pt,yt.static_tree=vt,yt.extra_bits=Wt,yt.extra_base=k+1,yt.elems=A,yt.max_length=T,yt.max_code=0,bt.dyn_tree=dt,bt.static_tree=mt,bt.extra_bits=Xt,bt.extra_base=0,bt.elems=O,bt.max_length=T,bt.max_code=0,wt.dyn_tree=gt,wt.static_tree=null,wt.extra_bits=Vt,wt.extra_base=0,wt.elems=M,wt.max_length=N,wt.max_code=0,n=0;for(r=0;r<C-1;r++){Lt[r]=n;for(e=0;e<1<<Wt[r];e++)Ct[n++]=r}Ct[n-1]=r,i=0;for(r=0;r<16;r++){At[r]=i;for(e=0;e<1<<Xt[r];e++)kt[i++]=r}i>>=7;for(;r<O;r++){At[r]=i<<7;for(e=0;e<1<<Xt[r]-7;e++)kt[256+i++]=r}for(t=0;t<=T;t++)Et[t]=0;e=0;while(e<=143)vt[e++].dl=8,Et[8]++;while(e<=255)vt[e++].dl=9,Et[9]++;while(e<=279)vt[e++].dl=7,Et[7]++;while(e<=287)vt[e++].dl=8,Et[8]++;En(vt,A+1);for(e=0;e<O;e++)mt[e].dl=5,mt[e].fc=_n(e,5);yn()},yn=function(){var e;for(e=0;e<A;e++)pt[e].fc=0;for(e=0;e<O;e++)dt[e].fc=0;for(e=0;e<M;e++)gt[e].fc=0;pt[L].fc=1,Bt=jt=0,Mt=_t=Dt=0,Pt=0,Ht=1},bn=function(e,t){var n=St[t],r=t<<1;while(r<=xt){r<xt&&un(e,St[r+1],St[r])&&r++;if(un(e,n,St[r]))break;St[t]=St[r],t=r,r<<=1}St[t]=n},wn=function(e){var t=e.dyn_tree,n=e.extra_bits,r=e.extra_base,i=e.max_code,s=e.max_length,o=e.static_tree,u,a,f,l,c,h,p=0;for(l=0;l<=T;l++)Et[l]=0;t[St[Tt]].dl=0;for(u=Tt+1;u<H;u++){a=St[u],l=t[t[a].dl].dl+1,l>s&&(l=s,p++),t[a].dl=l;if(a>i)continue;Et[l]++,c=0,a>=r&&(c=n[a-r]),h=t[a].fc,Bt+=h*(l+c),o!=null&&(jt+=h*(o[a].dl+c))}if(p==0)return;do{l=s-1;while(Et[l]==0)l--;Et[l]--,Et[l+1]+=2,Et[s]--,p-=2}while(p>0);for(l=s;l!=0;l--){a=Et[l];while(a!=0){f=St[--u];if(f>i)continue;t[f].dl!=l&&(Bt+=(l-t[f].dl)*t[f].fc,t[f].fc=l),a--}}},En=function(e,t){var n=new Array(T+1),r=0,i,s;for(i=1;i<=T;i++)r=r+Et[i-1]<<1,n[i]=r;for(s=0;s<=t;s++){var o=e[s].dl;if(o==0)continue;e[s].fc=_n(n[o]++,o)}},Sn=function(e){var t=e.dyn_tree,n=e.static_tree,r=e.elems,i,s,o=-1,u=r;xt=0,Tt=H;for(i=0;i<r;i++)t[i].fc!=0?(St[++xt]=o=i,Nt[i]=0):t[i].dl=0;while(xt<2){var a=St[++xt]=o<2?++o:0;t[a].fc=1,Nt[a]=0,Bt--,n!=null&&(jt-=n[a].dl)}e.max_code=o;for(i=xt>>1;i>=1;i--)bn(t,i);do i=St[x],St[x]=St[xt--],bn(t,x),s=St[x],St[--Tt]=i,St[--Tt]=s,t[u].fc=t[i].fc+t[s].fc,Nt[i]>Nt[s]+1?Nt[u]=Nt[i]:Nt[u]=Nt[s]+1,t[i].dl=t[s].dl=u,St[x]=u++,bn(t,x);while(xt>=2);St[--Tt]=St[x],wn(e),En(t,o)},xn=function(e,t){var n,r=-1,i,s=e[0].dl,o=0,u=7,a=4;s==0&&(u=138,a=3),e[t+1].dl=65535;for(n=0;n<=t;n++){i=s,s=e[n+1].dl;if(++o<u&&i==s)continue;o<a?gt[i].fc+=o:i!=0?(i!=r&&gt[i].fc++,gt[_].fc++):o<=10?gt[D].fc++:gt[P].fc++,o=0,r=i,s==0?(u=138,a=3):i==s?(u=6,a=3):(u=7,a=4)}},Tn=function(e,t){var n,r=-1,i,s=e[0].dl,o=0,u=7,a=4;s==0&&(u=138,a=3);for(n=0;n<=t;n++){i=s,s=e[n+1].dl;if(++o<u&&i==s)continue;if(o<a){do sn(i,gt);while(--o!=0)}else i!=0?(i!=r&&(sn(i,gt),o--),sn(_,gt),Mn(o-3,2)):o<=10?(sn(D,gt),Mn(o-3,3)):(sn(P,gt),Mn(o-11,7));o=0,r=i,s==0?(u=138,a=3):i==s?(u=6,a=3):(u=7,a=4)}},Nn=function(){var e;xn(pt,yt.max_code),xn(dt,bt.max_code),Sn(wt);for(e=M-1;e>=3;e--)if(gt[$t[e]].dl!=0)break;return Bt+=3*(e+1)+5+5+4,e},Cn=function(e,t,n){var r;Mn(e-257,5),Mn(t-1,5),Mn(n-4,4);for(r=0;r<n;r++)Mn(gt[$t[r]].dl,3);Tn(pt,e-1),Tn(dt,t-1)},kn=function(e){var i,s,o,u;u=it-G,Ot[Dt]=Pt,Sn(yt),Sn(bt),o=Nn(),i=Bt+3+7>>3,s=jt+3+7>>3,s<=i&&(i=s);if(u+4<=i&&G>=0){var a;Mn((t<<1)+e,3),Dn(),nn(u),nn(~u);for(a=0;a<u;a++)tn(X[G+a])}else s==i?(Mn((n<<1)+e,3),An(vt,mt)):(Mn((r<<1)+e,3),Cn(yt.max_code+1,bt.max_code+1,o+1),An(pt,dt));yn(),e!=0&&Dn()},Ln=function(e,t){$[Mt++]=t,e==0?pt[t].fc++:(e--,pt[Ct[t]+k+1].fc++,dt[on(e)].fc++,V[_t++]=e,Pt|=Ht),Ht<<=1,(Mt&7)==0&&(Ot[Dt++]=Pt,Pt=0,Ht=1);if(lt>2&&(Mt&4095)==0){var n=Mt*8,r=it-G,i;for(i=0;i<O;i++)n+=dt[i].fc*(5+Xt[i]);n>>=3;if(_t<parseInt(Mt/2)&&n<parseInt(r/2))return!0}return Mt==p-1||_t==v},An=function(e,t){var n,r,i=0,s=0,o=0,u=0,a,f;if(Mt!=0)do(i&7)==0&&(u=Ot[o++]),r=$[i++]&255,(u&1)==0?sn(r,e):(a=Ct[r],sn(a+k+1,e),f=Wt[a],f!=0&&(r-=Lt[a],Mn(r,f)),n=V[s++],a=on(n),sn(a,t),f=Xt[a],f!=0&&(n-=At[a],Mn(n,f))),u>>=1;while(i<Mt);sn(L,e)},On=16,Mn=function(e,t){Q>On-t?(K|=e<<Q,nn(K),K=e>>On-Q,Q+=t-On):(K|=e<<Q,Q+=t)},_n=function(e,t){var n=0;do n|=e&1,e>>=1,n<<=1;while(--t>0);return n>>1},Dn=function(){Q>8?nn(K):Q>0&&tn(K),K=0,Q=0},Pn=function(){if(U!=0){var e,t;e=Yt(),F==null?F=I=e:I=I.next=e,e.len=U-z;for(t=0;t<e.len;t++)e.ptr[t]=R[z+t];U=z=0}},Hn=function(e,t){var n,r;Ft=e,It=0,typeof t=="undefined"&&(t=i),Kt(t);var s=new Array(1024),o=[];while((n=vn(s,0,s.length))>0){var u=new Array(n);for(r=0;r<n;r++)u[r]=String.fromCharCode(s[r]);o[o.length]=u.join("")}return Ft=null,o.join("")};window.RawDeflate||(RawDeflate={}),RawDeflate.deflate=Hn})();